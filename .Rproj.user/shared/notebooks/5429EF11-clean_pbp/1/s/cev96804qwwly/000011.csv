"0","pbp_df_by_defender <- pbp_df %>%"
"0","  group_by(game_id, slug_team) %>%"
"0","  mutate("
"0","    stint_home = ifelse(slug_team == team_home, cumsum(msg_type == 8) + 1, NA),"
"0","    stint_away = ifelse(slug_team == team_away, cumsum(msg_type == 8) + 1, NA)"
"0","  ) %>%"
"0","  group_by(game_id) %>%"
"0","  mutate("
"0","    across(starts_with(""stint""), ~ na.locf0(., fromLast = TRUE)),"
"0","    across(starts_with(""stint""), ~ na.locf(.))"
"0","  ) %>%"
"0","  ungroup() %>%"
"0","  pivot_longer("
"0","    cols = starts_with(""lineup""),"
"0","    names_to = ""lineup_location"","
"0","    values_to = ""lineup"","
"0","    names_prefix = ""lineup_"""
"0","  ) %>%"
"0","  mutate("
"0","    pts_team = ifelse(lineup_location == ""home"", shot_pts_home, shot_pts_away),"
"0","    pts_opp = ifelse(lineup_location == ""away"", shot_pts_home, shot_pts_away),"
"0","    poss_team = ifelse(lineup_location == ""home"", poss_home, poss_away),"
"0","    poss_opp = ifelse(lineup_location == ""away"", poss_home, poss_away),"
"0","    slug_team = ifelse(lineup_location == ""home"", team_home, team_away),"
"0","    slug_opp = ifelse(lineup_location == ""away"", team_home, team_away),"
"0","    stint = ifelse(lineup_location == ""home"", stint_home, stint_away)"
"0","  ) %>%"
"0","  filter(off_slug_team != slug_team) %>%"
"0","  separate_longer_delim(cols = lineup, delim = "", "") %>%"
"0","  rename(player_name = lineup) %>%"
"0","  mutate("
"0","    personal_fouls_after_event = case_when("
"0","      fouling_player == player_name ~ personal_fouls_after_event, "
"0","      .default = NA"
"0","    )"
"0","  ) %>%"
"0","  mutate(personal_fouls_after_event = as.numeric(personal_fouls_after_event)) %>%"
"0","  group_by(game_id, slug_team, player_name) %>%"
"0","  fill(personal_fouls_after_event) %>%"
"0","  ungroup() %>%"
"0","  mutate(personal_fouls_after_event = ifelse(is.na(personal_fouls_after_event), 0, personal_fouls_after_event)) %>%"
"0","  group_by(game_id, slug_team, player_name) %>%"
"0","  mutate("
"0","    personal_fouls_during_event = case_when("
"0","      fouling_player == player_name ~ personal_fouls_after_event - 1,"
"0","      TRUE ~ personal_fouls_after_event"
"0","    )"
"0","  ) %>%"
"0","  ungroup()"
